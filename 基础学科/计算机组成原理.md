# 计算机组成原理

## 晶体管和电子管

电子管：

- 结构: 导线，金属片，玻璃外壳，真空环境

- 管脚数：6或更多

- 功耗：几个瓦特

晶体管：

- 结构：由硅制成的固态原件
- 管脚数：3 
- 功耗： 几百毫瓦

## 集成电路：

集成的是晶体管；

第一个集成电路集成了4晶体管

用集成电路做计算机效率更高

## 单位：

K  ： 2^10

M :   2^20

G : 2^30

T : 2^40

>  IC : 集成电路

IC 的集成度越高:

- 价格低
- 速度快（因为路程短了）
- 体积小
- 功耗低
- 可靠性高

## 微处理器时代

第一个微处理器字长为4位

之后又更改为8位，一个8位的微处理器为Intel8080 ，他的问世标志着微处理器时代的到来

个人计算机：最早的个人计算机是苹果公司研发生产的

寻址4G的空间，是2^32 个bit 

#### Intel公司的典型微处理器产品

8080

8086

80286

80386

Pentium

Pentium Pro

Pentium 2 

Pentium 3

Pentium 4

 CPU 的位数：

​       指的是算数运算单元的位数

加个“准” 字，说明数据总线不是相应位数。

IBM 公司的PC产品，小型机

### 新技术：

-  超标量:两条指令同时执行，既有两个CPU
- 流水线：并行
- RISC ： 简单指令
- 工作站：中型机

### 程序存储，顺序执行。。冯诺依曼提出的计算机原理



## 数制系统

十进制：

0,1,2,3 4 5  6 7 8 9

逢十进一

计算机使用二进制数的原因是：

 。。。

十进制： D

二进制：B

八进制：Q

十六进制： H

小数变二进制：乘二取整，第一位为高位



二进制变八进制：

三个数为一个单位，划单位

十进制的小数有些是不能准确表示成小数的，会无限，

## 数的表示

### 有符号和无符号数

- 无符号数：
- 有符号数：首位是符号位，0是正，1是负
  - 有符号数和无符号数，相同的位 能表示的数的个数是相同的，均为2^n
  - 有符号数=机器数=机器码
  - 把符号位和数值位一起编码的数，叫做机器数或机器码
  - 0，+，-，无穷，小数点：均为特殊

- 定点数的表示

  - 小数点位置固定不变的数，定点运算是基本运算，浮点运算会转化为定点运算
  - 定点小数：整数部分为0；
  - 定点整数： 整数
  - 小数点中是没有物理实体记录小数点的小数点在人心中（定点数）
  - 

  

  

  ​		

- 浮点数
  - 小数点位置不是固定不变的数
  - 小数点位置可以放在任意位置
  - 为何要用浮点数：
    - 定点数在数的表示范围上是有限制的
    - 定点数的精度是有限制的
    - 浮点数表示数的范围和精度都是很高的

## 机器码（至少十分）

- 机器码与真值
  - 真值可以用二进制表示，也可以用十进制表示
  - 机器码的表示：原码，反码，补码，移码
  - 真值：带符号的数，二进制的在本课程中也不用写（2）下标
- 原码
  - 原码，就是他的机器数
  - 原码千万不要写（2）下标
  - 计算机中我们需要的最基础的码就是原码
- 反码
  - 符号位不变，其他数取反，仅针对负数
- 补码
  - 反码末位加1（仅针对负数）
  - 补码的意义：可以将减法转化为加法运算，大大减少了运算器的复杂度
- 移码
  - 补码的符号位取反就是移码
  - 解决用编码就能判断数的大小，一般只有通过真值才能认为判断大小，转换为移码后，移码就没有符号位了，全是数值位
  - 移码主要用在浮点数运算中

--- 对于正数：符号位为零，原码=补码=反码

--- 补码的例子是参考了调时钟的生活实际，

- 原码实现了对符号位的表示
- 反码是补码的过渡
- 补码是为了将减法转化为加法

1. 原码的运算： 既所有手工运算
2. 补码的运算：计算机中进行了运算

例一：

设及其数字字长为8位（其中一位是符号位）。对于整数，党旗分别代表无符号数、原码、补码和反码时，对应的真值范围各自多少

![](D:\截图\离散数学\5.png)

原码和反码的取值范围是相同的

> 对一个补码再求一次补码，就得到了原码
>
> 对一个反码再求一次反码，就得到了原码
>
> 有理论依据的公式

# 开年第一节课

## 3.系统总线。

总线在计算机的外围

主存：Main Memory

CPU 

IO设备



总线是解决计算机内部互联的。

- 分散连接
- 中央交换结构
- 总线结构

冯诺依曼结构计算机就是分散连接

### 3.1 总线互联

#### 3.1.1 总线的概念

总线是多个模块共享的通信通路。

特征：

- 共享：成本低，结构简单，灵活性好，但是不能并行
- 分时
- 平等竞争

总线的组成：

- 传输线
- 总线接口逻辑
- 总线仲裁部件

传输线：

每一根导线就是一根传输线

​	RS232:设备总线   标准 25    简化 9 

​	EISA ： 系统总线   198 

按照功能的不同： 

- 数据线
- 地址线
- 控制线

总线  叫 ： BUS

数据总线： 传输数据的通路 ，       数据线也叫数据总线。。总线： 代表多根的意思。

- 双向
- 数据线宽度
- 并行传输能力

地址线： 也叫地址总线

- 传输数据地址的通路
- 单向，由CPU发出        说明目前的计算机是集中控制的计算机
- 地址线宽度
- 寻址、寻址能力

指令系统  ： 软件开发的模式和框架

总线位数越高，（如地址线），则寻址范围越广，性能越好。但是导线越多，相互 干扰越强，目前普遍使用64位总线

控制线：

- 传送控制信号的通信
- 单向
- 命令、响应、定时

典型的控制线：

1. 电源（3、5V)、地
2. 时钟
3. 复位
4. 存储器读
5. 储存器写
6. I/O 读
7. I/O写
8. 总线请求
9. 总线授权
10. 中断请求
11. 中断响应
12. 传输响应 

时钟周期：计算机中的最小时间单位，发出方形波，在上升沿做判断，在下降沿做动作。

机器周期

指令周期



时间漂移： 只要范围小于T/2，就认为是正确的



#### 3.1.2 接口逻辑

外部设备的个体差异

- 速度
- 数据表示
- 操作方式

统一的，规整的  设备

CPU只控制接口。

方式： 串行   并行

接口逻辑提供了一个能力范围，在这一范围内，CPU能用简单的方法访问多种类型的设备。

按照一定规则生产设备。

功能: 

- 连接器
- 转换器

接口也成为 适配器。

#### 3.1.3仲裁部件

- 为什么要仲裁
- 什么是仲裁
- 仲裁方法

方式 ： 集中式，分布式。

#### 3.1.4 总线的工作过程

总线的主设备（CPU）、总线从设备

总线的状态 ： 总线忙（低电平）     总线不忙（高电平）

总线占用期

总线事务：

- 请求
- 裁决
- 地址
- 数据
- 释放



总线不忙的时候，总线传输 “空号” 为逻辑1 （只有1 和 0） ，行业习惯为 逻辑1



总线的工作过程： 

1. 申请
2. 授权
3. 使用
4. 释放

计时器： 均为归零计时器： 从 45 开始，减一、减一 直到 0 结束。



总线的分类：

按传送方式：

- 串行总线，数据线只有一根。传输线有若干根
- 并行总线，数据线有多跟。复杂。远距离传送用串行。

按数据线的宽度：

- 8 bit 
- 16 bit
- 32 bit
- 64 bit

按照总线所处的位置： 

- 片内总线     也叫局部总线
- 系统总线
- 外总线       也叫设备总线

按总线作用的方位： 

- 局部总线
- 系统总线
- 设备总线

### 3.2四大特性

- 机器特性，物理连接
- 电器特性，逻辑连接，解决逻辑0 和逻辑1 的问题
- 功能特性，功能定义
- 时间特性，动态特性，也叫过程特性

使用负逻辑 能使 效率更高

#### 总线的主要性能指标和设计要素

时钟频率 : 时钟周期。

信号线类型 ： 

- 专用： 数据线和地址线和控制线 互不干扰，并排进行
- 复用 ： 地址线和数据线合并，分时运行，先地址，后数据

总线宽度： 数据线宽度 /地址线宽度

总线带宽： 总线的宽度就是数据线的宽度。带宽由时钟频率和数据线宽度决定。每秒总线传输的二进制位数

定时方式：

- 同步
- 异步
- 准同步

传送方式： 

- 串行
- 并行

仲裁策略： 

- 集中、
- 异步

数据传输类型： 读、写、读-修改-写、写后读、块操作 （不用看）

即插即用：

#### 3.2.4 总线的标准化

- 标准化的要求
- 标准化的途径

#### 3.1.5多总线分级结构

- 但总线结构
- 传统的多总线分级结构
- 中间层结构

# 第二课

## 总线的工作过程

BR	：  先申请，再使用。

BG ： 总线仲裁、授权

BB ： 获得总线的使用权的设备之总线忙

释放: 一个总线占用期后释放总线。

## 单总线结构：

系统总线。

只有一条总线的结构叫做单总线结构。

## 传统的多总线结构。

局部总线： 局部总线是	CPU总线的外延。连接CPU和Cache。高速总线。

系统总线: 主存和Cache都连在系统总线上。

扩充总线。



只适用于 80486 CPU

多总线结构：  和主存储器连接的总线一定就是系统总线。

## 中间层结构：

使用与所有CPU

局部总线 系统总线  高速总线   扩充总线

## 系统总线 ：

## 总线定时：

- 同步的概念
- 同步定时

同步的概念： 

什么是同步，基本方法

通信定时： 

发送方  接收方  总线

不发送信息的时候 我们希望接收方不收到信息。

当总线不工作时，一直在传输空号，既 11111....  。

如果 A没有发送，B就不要接收。------这就是同步

同步的方法：

- 同步定时
  - 最主要的特征：时钟
  - 存在时钟漂移缺点，不能进行远距离传送
- 异步定时
  - 打电话 就是一个典型的异步定时
  - 请求 
  - 应答
  - 由请求触发应答
  - 请求和应答的互锁关系：
    - 不互锁
    - 半互锁： 请求的结束 由响应的开始决定
    - 全互锁 ： 请求的结束由响应的开始决定；应答的结束由请求的结束决定
  - 互锁方式 越安全，越复杂。 我们使用这种方案。选用半互锁。
- 准同步定时: 在同步定时的基础上 ，增加向存储器询问是否准备好这一步骤。
- 远距离通信用异步定时。同步定时对部件要求比较高。

## 数据传送方式

在总线上传送数据。

- 串行传送
- 并行传送

数据在总线上怎么传的:

## 几个概念：

- 数据

- 信号
  - 振幅
  - 频率。调频的收音机更好
  - 相位 。调相的设备一定是准确度要求很高的设备。
- 信息

- 码元

- 传输开销

01 信息由信号进行携带，通过调制后携带01信息，携带01信息的信号叫做码元

基本的传送方式：

串行传送： 

	-  一根数据线就把数据传送走了

并行传送： 

- 多根数据线

计算机内部的数据是并行的。

## 串行传送：

- 异步传送：
  - 帧 ：
  - 波特率：信号变化的频率，单位: Baud
  - 数据传输速率：单位时间传输的那位位数，位/秒。字节/秒。。字： 各个计算机的定义不一致。但是字节： 就是指 8 bit。理想的数据传输速率叫做 总线带宽
- 同步传送： 

一元调制 ： S = B 。数据速率 和波特率是相等的。 一个波特信号 携带 一个二进制位

多远调制： S> B      数据速率大于波特率       一个信号携带两个二进制位

目前一个信号携带4个二进制位。一个信号有16 个状态

## 并行传送：

- 基本原理
- 优缺点及应用
- 并串行传送

# 第三次课

## 3.4仲裁策略

1. 仲裁概述
2. 集中式仲裁，成熟，用的多
3. 分布式仲裁，书上没有，不成熟，效率高

仲裁是一种开销。

### 集中式仲裁：

1.  链式查询
2. 独立请求
3. 计数器定时查询。

#### 1。链式查询的方式

独立的总线控制部件。

当BB 处于总线忙的状态，则不进行总线使用权的分配。

加横杠代表低电平。

![](D:\截图\计算机组成原理\QQ截图20220315193008.png)

#### 独立请求：

![](D:\截图\计算机组成原理\QQ截图20220315193517.png)



#### 计数器定时查询

链式查询和独立请求的综合应用

![](D:\截图\计算机组成原理\QQ截图20220315194810.png)

没有BG 总线授权线

### 分布式总裁

### 没有集中的总线总裁部件。

### ![](D:\截图\计算机组成原理\QQ截图20220315200946.png) 

设备三的优先权最高，设备0 的优先权最低。

没有BG线

每个设备都有一定的智能，可以自己判断自己是够有权获得使用权。

## PCI  总线

使用独立请求总裁方法

隐式总裁： 减少总裁的开销

独立于CPU的体系结构

无限读写线性猝发传送

PCI 总线的扩充性好

兼容性好

plug and play

优化系统的性能

低功耗

两种标准电压  5V  3.3 V 

标准化程度高



## 存储器

内存： Cache + 主存储器（主存）

CPU 中有寄存器

外存 ： 外部储存设备。是外围设备

CUP可以直接访问寄存器 和Cache



位    字节   字 

一个字没有固定长度单位，和计算机型号有关。

字长： 一个字由多少个位构成

字数： 存储器中存储的 字的数量，和计算机型号绑定



外存 没有字数概念，只能以byte 或者位做单位

# 第四次课

储存方法：非常重要

- 顺序存取：
- 直接存取：介于顺序存取和随机存取之间，如硬盘。

- 随机存取：数据存储位置和访问时间无关。**共享地址译码**

- 关联存取：不是按地址访问，而是按内容访问，速度非常快，但是容量小，结构复杂。在Cache中才用到

硬盘： 磁道 大小不同，但是每个磁道存储的信息容量是相同的，每个磁道有不同的项区，寻道 是顺序存取，时间与位置有关，但是在一个项区内部，获取某个数据采用随机存取，时间与位置无关。

关键性能：

- 存取时间
- 存储周期
- 传送速度

存储周期 = 存取时间  + 复原时间

存取时间 =  译码时间 +  读写时间

传输速度：

也称为： 传输率 、存储器带宽

对于主存储器，是单位时间内数据传入/传出主存的位数

关键特性： 物理类型

- 半导体存储器： 通常是 易失的（停电既无）；可擦除的。也有非易失的 半导体存储器，但只能是 只读存储器。
- 磁表面存储器：可擦除的
- 光介质存储器： 可擦除的

## 分层结构：

追求:  是相互矛盾的，不可存于同一器件

- 大容量
- 高速度
- 低成本

传统存储器层次结构：

- 寄存器
- Cache
- 主存储器
- 磁盘
- 磁带

当代：

- 寄存器
- Cache
- 主存储器
- 磁盘告诉缓存
- 磁盘
- 磁带、光盘

三级缓存管理：![image-20220317193406337](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220317193406337.png)

CPU能直接访问Cache 和主存，但不能访问硬盘。

在存储器之前从来没有位的操作，最小的单位为字节。硬盘以块 为单位向主存交换信息。

管理硬件 需要驱动，软件 就是操作系统。

储存结构相对于CPU透明，表示CPU无法了解储存结构的详细内容。

## 主存储器的组成

存储体---关键

外加一些外围设备

译码选择：两根地址线可以译码出四种情况。 

存储体的组成：

最小单位是存储元。一个二进制位。

若干存储元构成存储单元。存储单元一定是八的整数倍CPU只能访问到存储单元。

给每个单元都有一个编号，既单元地址。具有唯一性。

存储体是存储信息的地方，是存储器的核心部件。

存储容量： 存储单元的总和，或者存储元的总和。

存储器 ： 是计算机 的重要部件，是存储程序和数据的。

程序是为了处理数据的。

存储体的编址方式。

- 按字编址： 每一个字给出一个地址。字一般位数大于字节
- 按字节编址：每一个字节给出 一个地址。既可以从高字节开始，也可以从低字节开始。

## 半导体主存储器。

- 概述
- SRAM   静态存储器
- DRAM   动态存储器
- ROM 
- 存储体组织结构

分类： 

- RAM  随机访问存储器。可读可写
  - 双极型：速度非常快（容量肯定不大，成本非常高）。一般用于Cache 和寄存器
  - MOS型
    - SRAM： 靠电阻存储信息。
    - DRAM:靠电容存储信息。不稳定。主存都是用的DRAM ，都是优化过的

- ROM   read only memory ，只可读，则不易失

存储元：

-  结构
- 双稳态分析
- 信息存储原理
- 读写 操作

六级管SRAM 储存器：

原理： 电阻分压



MBR 寄存器。

寄存器只能在CPU内部。

存储器访问的最小单位为字节。

存储元：SRAM

信息存储原理：电阻分压

优点： 读写速度快，且速度相同

缺点： 集成度低。



读写操作：

- 选中：和地址相关，通过地址选中了该存储源，然后才能读写。
- 读出/写入
- 优缺点

![](D:\截图\计算机组成原理\1.png)



逻辑1 ： 高电平



SRAM存储器组成

地址反向器： 非门。用于增强信号。

![](D:\截图\计算机组成原理\2.png)



驱动器 ： 放大信号。因为行信息负载比较重。

X 行 样驱动一整行的位，负载大。而Y 信息只需要驱动一个位，负载小，故而只有行有驱动器。

双译码器结构



# Intel 2114 特性： 考试不会告诉你。

是一个SRAM

1K * 4bit 

4096 个位。64 * 64的存储矩阵

![](D:\截图\计算机组成原理\3.png)

列选择是 4位 为一个单位。共16 个单位

作为一个芯片,至少要有 Vcc 电源 和 GND大地

读写周期：

CS ： 片选信号

RD： 读信号

## DRAM

- 存储源
- 单管DRAM存储源
- Intel4116

![](D:\截图\计算机组成原理\4.png)

选中这个存储源需要 X 有效 Y有效

读写时间不同：

写操作 很精简，读操作很复杂。写快读慢

读：

先预充电压，比逻辑1 的电压大一些。

在XY选中





用读操作 来刷新，让弱化的1 重新充满电荷。

如何区分读操作和刷新、



单管DRAM存储器

Intel 4116 DRAM 芯片

16K *1位。16K个存储元

为什么要刷新： 因为DRAM是靠电容存储数据的

刷新的原理和方法



刷新使用读操作完成的

如何操作 读 和刷新 ？

刷新： 只需要让X线有效，Y 线无效，一下子选中一整行（于矩阵中）；然后进行读操作，因为Y无效，所以数据读不出去

刷新周期：2ms.对于这个芯片全部进行刷新一边的时间间隔。2ms后信息就丢失了。

读写周期： 0.5us

每次刷新一行，用一个读操作完成。

整个芯片需要128次读操作，所需要的时间未128 个读周期。一共需要64us



集中式刷新： 

只要开始刷新，就连续的把128 行全刷完

刷新中的64 us CPU不能进行访问，这段时间称为死时间

CPU访问 和刷新冲突时，刷新优先





分散式刷新：

工作0.5us ，刷新0.5us

在128个工作周期

异步式刷新



ROM 只读存储器

MROM 

M : mask 掩磨式只读。0  和1  都已经固化好了

PROM : 可编程的ROM。P ： 一次编程，只能改一次

EPROM ： 可擦除的ROM。光擦除，紫外线擦除,整片擦除

EEPROM： 电擦除，字节级擦除





# 存储体组织

存储器，容量大了 速度就会慢

## SRAM和DRAM 与CPU的连接









# Cache

概述

地址转换的方法

。。

## 概述

目的： 优化驻村的速度。CPU的眼里只有主存

最早的cache还在CPU的外边。

实现的技术：一定要用硬件实现。计算机的一切功能都能用软件 或 硬件实现。软件实现的话硬件简单但是速度慢，硬件实现硬件复杂但是速度快。

结构为： SRAM。

透明性。

三个阵列：

地址   存储       替换



地址变换阵列  ： 是由相联存储器组成的，速度快，容量小。



## 地址变换的方法：就三种

- 映象     主存的地址 转换为 cache的地址。
  - 全相连映象  过于复杂
  - 直接相连   简单 ，对cache的利用率不高
  - 组相连映象（列相连）  折中

主存和cache之前信息交换的单位 为块

常用： block= 4B 。

可以横着画，也可以竖着画

Cache = 64 B    16 块          需要六根地址线

主存 = 1024B   256块		需要10根地址线。      巧妇难为无米之炊，地址线的数量必须是这样

主存： MM  main memory

tag 标记  。地址阵列 就是tag的实际，相连存储器。

地址阵列每个单元是四位



组向连：

Cache 两路组向连，每组分两块

​     四路组相连有四条路。两路组相连非常简单，是常用的







## 替换策略

不命中的时候

