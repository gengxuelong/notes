# 操作系统

操作系统是撑起来了整个信息系统的核心软件

以Linux系统为教程内容。

实践性很强（从时间总结出的原理）

设计面广（并行程序，性能问题，结构问题，程序方法论，软件工程等等）

错综复杂： 纵横交叉

课程枯燥，概念繁多

 

操作系统： OS

- 设计或者修改现有的操作系统
- 加深对使用的OS的理解，有利于深入编程
- 设计到计算机科学的很多领域
- 大型、复杂系统的设计，思维方式的学习。

理解操作系统如何工作

# 第一章。操作系统概率

## 1.1什么是操作系统

- 操作系统时计算机系统中软硬件资源的管理者

硬件资源：CPU，内存，io设备，硬盘

软件资源: 文件（数据信息）

- 为用户提供以太等价的扩展机器或者虚拟机。把一个物理的核虚拟出多个虚拟核，让同时运行多个进程。
- 最重要、最基本、最复杂的系统程序，控制应用程序执行的程序。

操作系统时最底层的软件，也是系统软件。

数据库管理系统也是系统软件，是运行在操作系统上的。

定义：

计算机操作系统是指控制和管理计算机的软硬件资源，和理组织计算机的工作流程，方便用户使用的程序集合。

引入操作系统的目的:

- 方便性（用户的观点）
- 有效性（系统管理人员的观点）
- 可扩展性（升级的观点）
- 开放性（兼容的观点）

## 1.2操作系统的发展史

### 第一代： 是欧共操作

没有操作系统

语言： 机器语言

手工插板子

计算机处理能力的提高，手工操作的低效率，造成效率浪费。

### 第二代： 单道批处理系统：

语言： 汇编语言，Fortran

操作系统： FMS

一次提交多次作业

脱机系统： 让CPU的等待时间降低，提高了CPU的效率

联机系统：CPU等待时间较长



有点： 同一批内各作业自动依次更替，改善了CPU和io设备的使用效率，提高了吞吐率

问题： CPU和IO设备使用忙闲不均，取决于作业特性。

通道: 

中断：

### 第三代，多道批处理系统

1965   -- 1980

特点： 使用了继承电路

操作系统： 复杂、庞大

多道： 内存中同时存放几个作业

现代意义上的真正操作系统

IBM System/360 操作系统 :

庞大的软件怪兽，数千名程序员 的数百万行汇编语言代码。

有成千上万个错误。

随着时间的流逝，错误的数量大致保持不变。

由此引入： 将工程化的思想引入软件开发



优点：

资源利用率高

作业吞吐量大

缺点：

用户交互性差

作业平均周期时间长



### 第四代：分时系统

70年代 中期 至今

多个用户分享使用同一台计算机，多个程序分时共享硬件和软件资源

通常按时间片分配

特点：

同时性：宏观上看各个用户是并行的

交互性： 可以根据系统的相应结果再想系统发送请求，直到得到满意的结果

独立性: 各个用户之间彼此独立，互不干扰

及时性：响应会在较短的时间内得到响应



响应时间： 从发出指令 到系统给出响应的时间



### 分化发展

个人操作系统

实时操作系统

分布式操作系统

网络操作系统

汽车操作系统

机器人操作系统



## 1.3操作系统的功能

- 处理机管理
  - 进程控制
  - 进程同步
  - 进程通信
  - 进程调度
- 存储管理
  - 内存分配
  - 内存保护
  - 地址映射：逻辑地址 和物理地址之间的映射
  - 内存扩充：把磁盘虚拟成内存
- 设备管理   （IO设备，一般就比较慢）
  - 缓冲管理
  - 设备分配
  - 设备处理
- 文件管理
  - 文件存储空间的管理
  - 目录管理
  - 文件的读写管理和保护
- 用户接口
  - 命令接口
  - 图形接口
  - 程序接口

### 1.4 操作系统的特征（重点，考试必考）

- 并发：
  - 在操作系统中同时存在喜多活动，多个时间会在同一时间段内发生
  - 并行：是指两个或者多个事件在同一时刻发生（需要两个CPU核）
  - 在多道程序处理时，宏观上并发，围观上交替执行（在但处理器情况下）
  - 并行是并发的特殊情况

- 共享
  - 系统中的资源可供内存中多个并发执行的进程共同使用
  - 互斥共享方式，临界资源
  - 同时访问方式
  - 并发和共享是操作系统最基本的两个特征
- 虚拟
  - 通过某种技术把一个物理实体变成若干个逻辑是哪个对应物
  - OS时钟利用了多种虚拟技术
    - 虚拟处理机技术，
    - 虚拟储存器技术
    - 虚拟设备技术
- 异步性：
  - 进程的执行顺序和执行时间的不确定性
  - 难以重现系统在某个时刻的装填

SPOOLing系统“：

将输出设备由占用设备转换为共享设备

批处理操作系统的优缺点:

资源利用与高

吞吐量大

用户交互不好

作业周转时间长



## 分时操作系统

分时： 把计算机的系统资源 进行时间上的分割。每个时间段称为时间片。乜咯用户依次轮流使用时间片。

特征:

- 多路性，也称为同时性
- 独立性
- 及时性
- 交互性。分时系统的基本属性，方便了程序的调试

实现条件：

- 终端设备
- 轮转算法
- 绘画语言

响应时间：从终端发出命令到系统处理完这条命令并给予肥大所需的时间

影响响应时间的因素：

- 机器处理能力
- 请求服务的时间
- 系统中连接的终端数目
- 服务请求的分布
- 调度算法，时间片的选取

## 实时系统：

应用非常广泛。系统的正确性不仅仅依赖于计算的逻辑结果，而且依赖于结果产生的时间。

实时系统： 能够在指定或者确定的时间内完成系统功能和我对外部或者内部、同步或则异步事件做出响应的系统。

网络操作系统

分布式操作系统

- 透明性 ： 资源共性，分布对用户来说不可知
- 自治性： 处于分布式操作系统的多个主机处于平等地位。诶主从关系

优点：处理能力增强、速度更快，可靠性增强

多处理操作系统

N个处理器加速达不到N倍

提高系统的可靠性： 故障时系统降级运算

类型:

紧密耦合 ： 各个处理器之间通过快速总线或者开关阵列相连，共享内存，整体系统由以个统一的OS管理，一个OS核心

松耦合： 多个OS核心





非对称式多处理：

又称为主从模式。

主处理器 

从处理器



对称式处理器。



嵌入式系统：







## 1.6操作系统的结构









# 操作系统的第三讲

用户与操作系统的接口

作业级接口

程序级接口

2

# 2.3 系统调用

系统调用时操作系统提供给软件开发人员的唯一接口。

管态和算态：

算态： 用户态，用户工作的状态

管态: 系统太，系统程序工作的状态

CPU 拥有三种指令：

特权指令    算态指令   访管指令

操作系统 不仅可以调用特权指令，也能调用算态指令

访管指令：转换态时，有用户调用，由系统执行。

系统调用： 至少包括一套访管指令在内的、由操作系统代替用户完成的某些特定功能的程序段。

- 将系统转入管态，只能有汇编语言直接访问。
- 是操作系统提供给编程人员的唯一接口
- 功能 : 完成云硬件相关的工作以及控制程序的执行

设备管理

文件管理

进程控制

进程通信

。。。

文件属于软件资源。



线路指令就是访管指令

CPU处理那个程序，寄存器中才存哪个程序的相关数据（如执行到哪一行了）。

保护处理机现场： 就是将寄存器中程序的相关数据转移到内存中。



编译： 将高级语言转换为机器可以识别的机器语言（汇编语言）

用户处理   ----------》   先出处理机构 ------------》系统子程序

由用户转向系统的过程的参数传递：

由陷入指令自带参数： 陷入指令的长度有限。，只能自带有限个参数

通用寄存器

在内存中开辟栈区

系统调用 和普通过程（函数）调用的区分：

- 系统调用时动态调用，调用的时候所调用的程序位置和具体实现用户都不知道。一般的调用是静态的调用。
- 运行状态： 系统调用运行在不同的系统状态，一般调用运行在系统状态。

系统调用是用户态使用管态指令的一种方式，系统调用管态指令直接调用就好，不需要使用系统调用



# 第三章 进程管理。考试分数占一半

- 顺序程序.单道处理
  - 顺序性
  - 封闭性
  - 可再现性
- 并发程序。多道处理。微观上间断执行。默认都是单核计算机
  - 间断（异步）性
  - 失去封闭性
  - 不可再现性

多道程序系统：

- 并行性
- 制约性
- 动态性

进程： 程序在处理机上执行时所发生的的活动。

是一个容器，该容器用以聚集相关资源。

进程特性：

- 动态性
- 并发性
- 独立性：拥有自己独立的进程控制块，PCB，相当于户口本一样
- 异步性
- 交互性

进程=  程序 + 数据 + PCB

一个程序 何以对应多个进程，一个进程可以包含多个程序。

335 分   380分

PCB ： Process Control Block

进程控制信息：

- 当前状态
- 优先级
- 代码之心入口
- 程序的外存地址
- 运行统计实现
- 进程间同步和通信；阻塞原因

CPU线程保护机制： 进程离开CPU时，寄存器的向观众值移进内存中

PCB表： PCB表的大小决定了系统中最多可以同时存在的进程个数。称之为系统的并发度





新创建进程时，为新的进程分配PCB。

进程状态转换

运行   等待   就绪    



五状态：

创建状态，就绪状态，等待状态，执行状态，终止状态



七状态进程模型

挂起进程模型：

- ​	阻塞挂起 ：进程在外存并等待某事件的出现

- 就绪挂起：进程在外存，但只要进入内存，即可运行



原语： 要么都执行，要么都不执行。既原子性

调度的类型

- 高级调度
- 中级调度
- 低级调度

进程调度的任务：

## 调度的性能准则

- 面向用户的调度性能准则。
  - 周转时间，平均周转时间
  - 平均带权时间： 周转时间/实际工作的时间   （大/小）
  - 截止时间：开始截止时间 和完成截至时间。任务必须在开始截至时间前开始，必须在完成时间之间结束。
- 面向系统的调度性能准则

## 进程调度的时机



## 进程调度的方式：

非剥夺调度

可剥夺调度



## 调度算法

- 先来先服务
